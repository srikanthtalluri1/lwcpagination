import getHistoryRecords from '@salesforce/apex/TechnologyDecision_HistoryHandler.getHistoryRecords';

const COLUMNS = [

   { label: 'Date', fieldName: 'createdDate', type: 'date',
     typeAttributes: {
          year: "numeric",
          month: "2-digit",
          day: "2-digit",
          hour: "2-digit",
          minute: "2-digit",
          hour12: true
      }
    }, 
    { label: 'Field', fieldName: 'fieldName', type: 'text' },
    { label: 'User', fieldName: 'createdById', type: 'url', 
      typeAttributes: { 
          label: { fieldName: 'createdBy' },
          target: '_blank'
      }
    },
    { label: 'Original Value', fieldName: 'oldValue', type: 'text' },
    { label: 'New Value', fieldName: 'newValue', type: 'text' }
   // { label: 'Source', fieldName: 'source', type: 'text' }
];

@track historyRecords = [];
    historyRecordsLength = 0;

 @track isLoading = false;
    @track error;

    handleTabChange(event) {
        console.log('event.target.value '+event.target.value);
        if (event.target.value === 'history' && this.historyRecords.length === 0) {
            console.log('before calling fetchHistoryRecords');
            this.fetchHistoryRecords();
        }
    }

    fetchHistoryRecords() {
        this.isLoading = true;
        console.log('entered fetchHistoryRecords');
        console.log('entered fetchHistoryRecords', this.recordId);
        getHistoryRecords({ decisionId: this.recordId })
            .then((data) => {
                console.log('data check '+JSON.stringify(data));
                //this.historyRecords = data;
                
                console.debug('this.historyRecordsLength ',this.historyRecordsLength);
                 this.historyRecords = data.map(row => ({
                ...row,
                Field: row.Field,
                OldValue: row.OldValue ? row.OldValue.toString() : '',
                NewValue: row.NewValue ? row.NewValue.toString() : '',
                CreatedDate: row.CreatedDate
            }));
                this.historyRecordsLength = this.historyRecords.length;
                console.log('this.historyRecords '+ JSON.stringify(this.historyRecords));
                this.error = undefined;
            })
            .catch((error) => {
                this.error = error;
                this.historyRecords = [];
            })
            .finally(() => {
                this.isLoading = false;
            });
    }

