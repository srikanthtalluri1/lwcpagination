@IsTest
private class technologyDecision_CreateFormHelperTest {

    // ---------- helpers to build the input maps ----------

    private static Map<String, Object> buildDecisionFields() {
        Map<String, Object> m = new Map<String, Object>();

        // TODO: put ALL required fields for TechnologyDecision__c here
        // Example only – change field API names / values as needed
        m.put('Name', 'Unit Test Decision');
        // m.put('Some_Required_Field__c', 'Some value');
        // m.put('Another_Field__c', true);

        return m;
    }

    private static Map<String, Object> buildRelationFields() {
        Map<String, Object> m = new Map<String, Object>();

        // TODO: put ALL required fields for TechnologyDecision_Relationship__c here
        // Example only – change field API names / values as needed
        m.put('Name', 'Unit Test Relation');
        // m.put('Owner__c', UserInfo.getUserId());
        // m.put('Some_Other_Required_Field__c', 'Some value');

        return m;
    }

    // ---------- main happy-path test ----------

    @IsTest
    static void testCreateDecisionWithRelation_success() {
        Test.startTest();
        String decisionIdString =
            technologyDecision_CreateFormHelper.createDecisionWithRelation(
                buildDecisionFields(),
                buildRelationFields()
            );
        Test.stopTest();

        System.assertNotEquals(null, decisionIdString, 'Method should return an Id');

        Id decisionId = (Id)decisionIdString;

        // Verify decision was created and linked to relation
        TechnologyDecision__c dec = [
            SELECT Id, TechnologyDecision_Relationship__c
            FROM TechnologyDecision__c
            WHERE Id = :decisionId
        ];

        System.assertNotEquals(
            null,
            dec.TechnologyDecision_Relationship__c,
            'Decision should be linked to a relation record'
        );

        TechnologyDecision_Relationship__c rel = [
            SELECT Id, Decision_Id__c
            FROM TechnologyDecision_Relationship__c
            WHERE Id = :dec.TechnologyDecision_Relationship__c
        ];

        System.assertEquals(
            dec.Id,
            rel.Decision_Id__c,
            'Relation.Decision_Id__c should be set to the created decision Id'
        );
    }

    // ---------- (optional) test to just exercise method with minimal maps ----------
    // Use this if you want extra coverage, but keep data valid so DML does not fail.
    @IsTest
    static void testCreateDecisionWithRelation_minimalData() {
        Map<String, Object> decisionFields = buildDecisionFields();
        Map<String, Object> relationFields = buildRelationFields();

        Test.startTest();
        String result =
            technologyDecision_CreateFormHelper.createDecisionWithRelation(
                decisionFields,
                relationFields
            );
        Test.stopTest();

        System.assertNotEquals(null, result, 'Result should not be null');
    }
}
