<template>
   <div class="slds-col slds-size_1-of-1">
  <div class="slds-combobox_container">
    <div class={dropdownClass}
         role="combobox"
         aria-expanded={isDropdownOpen}
         aria-haspopup="listbox"
         onclick={eatClicksInside}>  <!-- prevent bubbling to window -->

      <!-- Input field -->
      <div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none">
        <input type="text" 
               class="slds-input slds-combobox__input" 
               placeholder="Select filters..." 
               value={searchKey}
               oninput={handleSearch}
               onclick={toggleDropdown}/>
        <lightning-icon icon-name={iconName} size="x-small"
                        class="slds-input__icon slds-input__icon_right">
        </lightning-icon>
      </div>

      <!-- Dropdown -->
      <template if:true={isDropdownOpen}>
        <div class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid" role="listbox">
          <ul class="slds-listbox slds-listbox_vertical" role="presentation">

            <!-- Select All -->
            <li class="slds-listbox__item slds-border_bottom">
              <div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small">
                <span class="slds-media__figure slds-listbox__option-icon">
                  <lightning-input type="checkbox"
                                   value="SelectAll"
                                   class="select-all"
                                   checked={isSelectAll}
                                   onchange={onSelect}>
                  </lightning-input>
                </span>
                <span class="slds-media__body">
                  <span class="slds-truncate" title="Filters" style="font-weight:bold">Filters</span>
                </span>
              </div>
            </li>

            <!-- Options -->
            <template for:each={filteredOptions} for:item="opt">
              <li key={opt.value} role="presentation" class="slds-listbox__item">
                <div class="slds-media slds-listbox__option slds-listbox__option_plain"
                     role="option"
                     aria-selected={opt.selected}
                     onclick={handleSelect}
                     data-value={opt.value}>
                  <span class={opt.class}>{opt.label}</span>
                </div>
              </li>
            </template>

            <template if:true={noResults}>
              <li class="slds-listbox__item">
                <span class="slds-p-around_small">No results found</span>
              </li>
            </template>
          </ul>
        </div>
      </template>
    </div>
  </div>
</div>
</template>
